<project name="unit">

	<property name="test.build.dir" location="${basedir}/../../build/test" />
	<property file="${test.build.dir}/test.properties" />

	<path id="lib.path.id">
		<fileset dir="${lib.dir}" />
		<fileset dir="${test.lib.dir}" />
		<fileset dir="${project.lib.dir}" />
	</path>

	<target name="load-cobertura">
		<path id="cobertura.lib.path">
			<fileset dir="${test.lib.dir}" includes="*.jar" />
		</path>
		<taskdef resource="tasks.properties" classpathref="cobertura.lib.path" />
	</target>

	<!-- test -->
	<target name="unittest" depends="instrument">
		<mkdir dir="${junit.report.dir}"/>
		<junit haltonfailure="false" >
			<test name="com.pilgrim_lifestyle.model.eventer.AllTest" todir="${junit.report.dir}" />
			<formatter type="xml" />
			<classpath path="${instrumented.dir}" />
			<classpath refid="lib.path.id" />
			<classpath path="${classes.dir}" />
		</junit>
	</target>

	<!-- cobertura -->
	<target name="instrument" depends="load-cobertura">
		<cobertura-instrument todir="${instrumented.dir}">
			<fileset dir="${classes.dir}">
				<include name="**/*.class" />
				<exclude name="**/*Test*.class" />
			</fileset>
			<classpath refid="lib.path.id" />
		</cobertura-instrument>
	</target>

	<target name="coverage-report" depends="unittest">
		<cobertura-report srcdir="src/main/java" destdir="${cobertura.report.dir}" format="xml" />
	</target>

</project>